## 数据格式转换定义   

|日期|作者|备注|
|------|------|------|
|2019-6-26|宋建中|初稿|

## 指南

### 功能描述

* 通过配置将报文转换为通用的数据对象。
* 通过配置将报文存储入库。
* 不同格式报文(XML/JSON)间的转换
* 从数据库中获取数据形成报文

### 使用说明

* 核心服务：snsoft.bas.conver.service.ConverDataService

## 手册	

### 配置说明

* 主表定义

|列|说明|
|------|------|
|stoped|是否停用|
|fromfile|文件，配置来自于XML文件|
|convercode|数据格式转换配置编码|
|convername|数据格式转换配置名称|
|tac|通过TAC方式处理数据|
|listeners|通过监听方式处理数据|
|sheetcode|数据对应的业务单据号，现在还未使用|
|storeuri|非关系型数据库的存储地址， "MongoDB:XXX" 开头为MongoDB地址，"XXX"为Mongo参数集的前缀。|
|sqls|从数据库获取数据的SQL语句，多个使用 ";"号分割|
|savemode|保存方式，0:不保存;1:更新;2:插入;3:存盘|
|xmlhead|生成XML报文时的头信息(仅XML起作用)|
|dateformat|日期格式，日期转换为字符串显示，对应的方法为DateUtils.dateToString()，默认为 YYYY-MM-DD|
|remark|说明|


* 子表定义

|列|说明|
|------|------|
|elementcode|元素编码，非空，程序解析直接根据编码分级|
|elementname|元素名称，非空|
|elementdesc|元素描述，非空，仅为说明文字程序中并不使用|
|istable|是否为表，注意只要不是列或属性都认为是表|
|isattribute|是否为属性(仅XML起作用)|
|isrequired|数据是否非空，表、列、属性都起作用|
|storename|存储名称，非空，表名或列名，可以为虚拟名称|
|flddecimal|小数位限制，定义后数据或四舍五入处理|
|flddefault|默认值配置，类似VO默认值的配置|	
|fldregex|通过正则表达式格式校验|
|copyfield|拷贝主表字段，注意如果是关联字段则需要加前缀":"与界面定义类似|     	
|fldtype|字段数据类型，非空，-7:布尔;0:表;2:数值;4:整数;12:文本;91:日期|
|isvirtual|是否为虚拟字段或表，定义后不存储|
|isarray|仅用于 JSON转换，转换为array方式还是map方式|
|ishide|生成XML、JSON时不输出（不显示）|
|codetbl|码表定义的ID，根据码表定义码名映射，定义方式：|
||码表定义的ID,取数字段,商户所属字段(@开头为常量)|
|coderela|码表映射关系的编码，根据码表映射关系编码转换，支持第三方编码和系统编码的互转，定义方式：|
||IN/OUT(三方转入/转出),取数字段,码表映射关系定义ID,系统分类(请求方,@开头为常量),商户所属字段(响应方,@开头为常量)|          

## 实践

* 开发通用程序配合 **数据格式转换定义**实现报文的统一处理，通过监听方式实现差异性处理。
* 配合接入系统SN-ACS实现通用的报文数据接入、输出服务
