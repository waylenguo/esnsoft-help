# 服务器监控

|日期|作者|备注|
|------|------|------|
|2018-09-25|朱郁琼|初稿|

# 服务器信息
## 主表属性说明

服务器ID 每台服务器的唯一编号, 通过系统选项 `SN.ID`定义。

## 子表属性说明

### 服务器信息

服务器信息用来查询某台应用服务中的虚拟机参数，和`System.properties`、`core.inf`、`启动项`中配置的系统选项。
目前根据类型分为三组。
* 基本信息
包含底层配置文件路径设置和虚拟机内存使用情况信息。

* Java属性
虚拟机中通过 System.getProperties() 获得的属性配置。一般用来检查虚拟机参数设置和一些三方Jar包依赖的参数设置。

例如：
```
dubbo.application.logger：dubbo启用的日志类型是否为slf4j
org.jboss.logging.provider：hibernate启用的日志类型是否为slf4j
sn.test:标识当前是否为测试环境
file.encoding:当前的虚拟器字符集

其他信息都是虚拟机中的各种杂项属性，不需要关心。
```

* 系统配置
`System.properties`、`core.inf`、`启动项`中配置的系统选项。注意仅仅会显示属于系统选项的属性，而不是将System.properties全部列示。
关于系统选项设置请参照使用方式参见文档：<a target="_blank" href="help.html?helpFile=help/SN-CMC/SysOpTionsFile/SYSOPTIONSFILE.md"> 系统选项</a>

### 线程堆栈

线程堆栈页面显示当前应用服务器中的线程信息，用于查看是否有死锁线程。
当一条线程信息`耗时`较长，而且`死锁数`较大的时候(Locked synchronizers: count = n  n>1)，就需要特别注意是一条死锁线程。
产生死锁线程的代码会打在线程堆栈列里，开发人员需根据线程堆栈排查异常原因。

也可以使用【下载所有服务器线程】按钮功能，将当前线程堆栈保存为文本文件下载后查看。

### 数据库连接池

查看数据库连接池中的所有连接信息。用于查看是否有死锁的数据库连接。
当有用户占用连接长时间未释放时就可能是出现了死锁现象，现象如图：
![](help/SN-CMC/Server/ServerInfo/ServerInfo1.png)

此时，使用【查看全部连接堆栈】、【查看当前连接堆栈】按钮功能可以将占用连接的线程堆栈打印出来，
并且将产生死锁SQL语句打印在堆栈中。
使用【强制关闭连接】按钮功能可以将占用的连接强制关闭，暂时解决死锁问题。

```
数据源：数据源ID@连接序号
帐套：帐套ID
序号：连接池中的序号
生成时间：创建连接时间
正在使用：使用当前连接的用户信息
最近访问：最近使用连接的时间
失效：连接是否失效
已关闭：连接是否已关闭
事务：当前连接是否开启了自动事务
```


### 数据库信息

查看当前应用帐套文件中定义的数据源信息。供开发人员快速查看发布环境的帐套定义。
【查看数据库信息】按钮展示当前行的数据库连接字符串、数据库类型和数据库驱动版本。

```
编号：帐套ID
名称：帐套名称和url
```

### 文件系统池

查看FileSystem连接池中的FileSystem列表。供开发人员查看当前环境中使用的文件系统资源。

### BEAN信息

展示当前Spring容器中所有的Bean列表，供开发人员检查Bean是否成功注入（通过Ctrl+F查找）。

```
Bean:注入的Bean名称
实现类：注入bean的实现类名
实例：注入bean的实例id。
```

# 服务运行状态

# 在线用户查询

